<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem chi ti·∫øt vƒÉn b·∫£n</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.1);
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 40px;
            border-radius: 15px 15px 0 0;
        }
        
        header h1 { font-size: 2em; margin-bottom: 10px; }
        
        .back-button {
            display: inline-block;
            margin-bottom: 15px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .back-button:hover { background: rgba(255,255,255,0.3); }
        
        .content { padding: 40px; }
        
        .document-meta {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #1e3c72;
        }
        
        .document-meta h3 { color: #1e3c72; margin-bottom: 15px; }
        .meta-item { margin-bottom: 10px; color: #666; }
        .meta-item strong { color: #333; }
        
        .search-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            color: #856404;
        }
        
        .search-info strong { color: #1e3c72; }
        
        .article-navigation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #28a745;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .article-navigation h4 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.1em;
            position: sticky;
            top: 0;
            background: #f8f9fa;
            padding-bottom: 10px;
        }
        
        .article-link {
            background: #e3f2fd;
            border: 2px solid #1e3c72;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-block;
            margin: 4px;
            text-decoration: none;
            color: #1e3c72;
            font-weight: 600;
        }
        
        .article-link:hover {
            background: #1e3c72;
            color: white;
            transform: translateY(-2px);
        }
        
        .document-content {
            line-height: 1.9;
            font-size: 1.05em;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #333;
        }
        
        .document-content .highlight {
            background: #ffeb3b;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .document-content .target {
            background: #ff9800;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 700;
            border: 3px solid #f57c00;
            box-shadow: 0 3px 15px rgba(255, 152, 0, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 3px 15px rgba(255, 152, 0, 0.5); }
            50% { box-shadow: 0 5px 25px rgba(255, 152, 0, 0.8); }
        }
        
        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            display: none;
            z-index: 999;
        }
        
        .scroll-to-top:hover {
            transform: translateY(-5px);
        }
        
        .scroll-to-top.show {
            display: block;
        }
        
        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-button">‚Üê Quay l·∫°i</a>
            <h1 id="docTitle">ƒêang t·∫£i...</h1>
        </header>

        <div class="content">
            <div class="document-meta" id="docMeta"></div>
            <div id="navContainer"></div>
            <div class="search-info" id="searchInfo"></div>
            <div class="document-content" id="docContent"></div>
        </div>

        <footer>
            <p>H·ªá th·ªëng tra c·ª©u vƒÉn b·∫£n ¬© 2024</p>
        </footer>
    </div>

    <button class="scroll-to-top" id="scrollBtn">‚Üë</button>

    <script>
        window.onload = function() {
            loadDocument();
        };

        function loadDocument() {
            var data = sessionStorage.getItem('currentDocument');
            
            if (!data) {
                document.getElementById('docTitle').textContent = 'L·ªói';
                document.getElementById('docContent').innerHTML = 
                    '<div style="text-align:center;padding:60px;color:#999">' +
                    '<h3>‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu</h3>' +
                    '<p><a href="index.html">‚Üê Quay l·∫°i</a></p></div>';
                return;
            }

            var params = JSON.parse(data);
            var doc = params.doc;
            var mode = params.mode || 'search';

            document.getElementById('docTitle').textContent = doc.name;

            var metaHTML = '<h3>üìã Th√¥ng tin vƒÉn b·∫£n</h3>';
            metaHTML += '<div class="meta-item"><strong>File:</strong> ' + doc.fileName + '</div>';
            metaHTML += '<div class="meta-item"><strong>ƒêi·ªÅu kho·∫£n:</strong> ' + doc.articles.length + '</div>';
            document.getElementById('docMeta').innerHTML = metaHTML;

            if (doc.articles && doc.articles.length > 0) {
                var navHTML = '<div class="article-navigation">';
                navHTML += '<h4>üìë Danh m·ª•c (' + doc.articles.length + ' ƒëi·ªÅu kho·∫£n)</h4>';
                
                var unique = {};
                for (var i = 0; i < doc.articles.length; i++) {
                    var art = doc.articles[i];
                    var key = art.label + art.number;
                    if (!unique[key]) {
                        unique[key] = art;
                        navHTML += '<a href="#" class="article-link" onclick="scrollTo' + art.position + '(); return false;">';
                        navHTML += art.label + ' ' + art.number + '</a>';
                    }
                }
                navHTML += '</div>';
                document.getElementById('navContainer').innerHTML = navHTML;

                for (var key in unique) {
                    var pos = unique[key].position;
                    window['scrollTo' + pos] = createScrollFunction(pos);
                }
            }

            var infoHTML = '';
            if (mode === 'article') {
                infoHTML = 'üìç <strong>ƒêang xem:</strong> ' + params.articleLabel + ' ' + 
                          params.articleNumber + ' | üéØ <strong>ƒê∆∞·ª£c ƒë√°nh d·∫•u m√†u cam</strong>';
            } else {
                infoHTML = 'üîç <strong>T·ª´ kh√≥a:</strong> "' + params.query + '" | üéØ <strong>V·ªã tr√≠ m√†u cam</strong>';
            }
            document.getElementById('searchInfo').innerHTML = infoHTML;

            var content = doc.content;
            var sortedArticles = doc.articles.slice().sort(function(a, b) {
                return b.position - a.position;
            });

            for (var i = 0; i < sortedArticles.length; i++) {
                var art = sortedArticles[i];
                var isTarget = false;
                
                if (mode === 'article') {
                    isTarget = Math.abs(art.position - params.position) < 20;
                }
                
                var before = content.substring(0, art.position);
                var text = art.fullMatch;
                var after = content.substring(art.position + text.length);
                
                var wrapped = '<span id="pos' + art.position + '" class="' + 
                             (isTarget ? 'target' : 'highlight') + '">' + text + '</span>';
                content = before + wrapped + after;
            }

            if (mode === 'search' && params.query) {
                var regex = new RegExp('(' + escapeRegex(params.query) + ')', 'gi');
                content = content.replace(regex, function(match, p1, offset) {
                    if (Math.abs(offset - params.position) < 50) {
                        return '<span class="target">' + match + '</span>';
                    }
                    return match;
                });
            }

            document.getElementById('docContent').innerHTML = content;

            setTimeout(function() {
                var targetEl = document.querySelector('.target');
                if (targetEl) {
                    var pos = targetEl.getBoundingClientRect().top + window.pageYOffset - 150;
                    window.scrollTo({ top: pos, behavior: 'smooth' });
                }
            }, 500);
        }

        function createScrollFunction(position) {
            return function() {
                var el = document.getElementById('pos' + position);
                if (el) {
                    var pos = el.getBoundingClientRect().top + window.pageYOffset - 150;
                    window.scrollTo({ top: pos, behavior: 'smooth' });
                    
                    el.style.transition = 'all 0.5s';
                    el.style.transform = 'scale(1.1)';
                    el.style.boxShadow = '0 5px 20px rgba(255,152,0,0.6)';
                    
                    setTimeout(function() {
                        el.style.transform = 'scale(1)';
                        el.style.boxShadow = '';
                    }, 1000);
                }
            };
        }

        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        var scrollBtn = document.getElementById('scrollBtn');
        
        scrollBtn.onclick = function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.onscroll = function() {
            if (window.pageYOffset > 300) {
                scrollBtn.classList.add('show');
            } else {
                scrollBtn.classList.remove('show');
            }
        };
    </script>
</body>
</html>
